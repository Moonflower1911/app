<c-row class="mb-3">
  <c-col [md]="4">
    <c-input-group sizing="sm" class="search-input">
        <span cInputGroupText>
          <svg [cIcon]="icons.cilSearch"></svg>
        </span>
      <input id="searchBar" cFormControl (input)="triggerBasicSearch($event)"
             [placeholder]="'commons.form.search-input.placeholder'|translate"/>
    </c-input-group>
  </c-col>

  <c-col [md]="8" class="d-flex justify-content-end">
    <button cButton type="button" size="sm" color="primary" class="me-2">Expand All</button>
    <button cButton type="button" size="sm" variant="outline" color="secondary" (click)="openCuModal()">
      <i class="bi bi-plus-lg"></i> {{ 'administration.accounting.ledger-group.pages.list.add-button' |translate }}
    </button>
  </c-col>
</c-row>

<app-table-control (nextClicked)="next()" (previousClicked)="previous()" (sizeChanged)="changeSize($event)"
                   [currentNumberElements]="currentNumberOfElements" [hasNext]="hasNext"
                   [hasPrevious]="hasPrevious"
                   [size]="size"
                   [totalElements]="totalElements"></app-table-control>


@if (!firstCallDone) {
  <c-row class="d-flex justify-content-center mt-5">
    <c-spinner color="secondary"/>
  </c-row>
  <c-row class="d-flex justify-content-center mt-1">
    <c-col [md]="4" class="d-flex justify-content-center text-center">
      {{ 'commons.snippets.loading'|translate }}
    </c-col>
  </c-row>
} @else {
  @if (!isListEmpty) {

    <c-accordion>

      @for (ledgerGroup of listContent; track ledgerGroup.id; let i = $index) {
        <c-accordion-item #item="cAccordionItem" [visible]="false">
          <ng-template cTemplateId="accordionHeaderTemplate">
            <button (click)="setOpenedLedgerGroup(i); item.toggleItem()" [collapsed]="!item.visible" type="button"
                    class="w-100 d-flex justify-content-between align-items-center text-start px-3"
                    cAccordionButton>
              <!-- Left side: Icon + Title + Optional Description -->
              <div class="d-flex align-items-center gap-2 flex-grow-1">
                <i class="bi bi-chevron-down d-inline-flex align-items-center justify-content-center
                                    rounded-circle bg-secondary text-white"
                   style="width: 18px; height: 18px; font-size: 12px;">
                </i>
                <div>
                  <div class="fw-bold">{{ ledgerGroup.name }}</div>
                </div>
              </div>

              <!-- Right side: Badge + Subgroups + Action buttons -->
              <div class="d-flex align-items-center gap-3 ms-auto">
                <div class="text-end">
                  <app-badge [color]="ledgerGroup.enabled?'success':'dark'" [rounded]="true"
                             [smaller]="false">
                    {{ ('commons.labels.' + (ledgerGroup.enabled ? 'enabled' : 'disabled'))|translate }}
                  </app-badge>
                  <span class="text-muted d-block fw-normal subgroup-label">
                    {{ ledgerGroup.subledgerCount }} {{ 'administration.accounting.ledger-group.pages.list.labels.sub-ledgers'|translate }}
                  </span>
                </div>

                <!-- Action buttons (kept compact) -->
                <div class="d-flex align-items-center gap-1">
                  <button type="button" cButton size="sm" (click)="openCuModal(ledgerGroup, $event)"
                          class="btn-info-light py-1 px-2 d-flex align-items-center me-1">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button type="button" cButton size="sm"
                          class="btn-danger-light py-1 px-2 d-flex align-items-center"
                          (click)="confirmDeletion(ledgerGroup, $event)">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>

            </button>
          </ng-template>
          <ng-template cTemplateId="accordionBodyTemplate">
            <div class="accordion-body bg-white">
              <div class="mb-2">
                {{ ledgerGroup.description }}
              </div>

              @if (ledgerGroup.subledgerCount > 0) {
                @for (subledger of ledgerGroup.subLedgers; track subledger.id; let j = $index) {
                  <c-card class="subgroup bg-primary bg-opacity-10">
                    <c-card-body class="d-flex justify-content-between align-items-center text-start px-3">
                      <div class="d-flex align-items-center gap-2 flex-grow-1">
                        <div>
                          <div class="fw-bold text-primary">{{ subledger.name }}</div>
                          <span>{{ subledger.description }}</span>
                        </div>
                      </div>

                      <div class="d-flex align-items-center gap-3 ms-auto">
                        <div class="text-end">
                          <app-badge [color]="subledger.enabled?'success':'dark'" [rounded]="true"
                                     [smaller]="false">
                            {{ ('commons.labels.' + (subledger.enabled ? 'enabled' : 'disabled'))|translate }}
                          </app-badge>
                        </div>

                        <!-- Action buttons (kept compact) -->
                        <div class="d-flex align-items-center gap-1">
                          <button type="button" cButton size="sm"
                                  (click)="openCuModal(subledger, $event, ledgerGroup)"
                                  class="btn-info-light py-1 px-2 d-flex align-items-center me-1">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button type="button" cButton size="sm"
                                  class="btn-danger-light py-1 px-2 d-flex align-items-center"
                                  (click)="confirmDeletion(subledger, $event)">
                            <i class="bi bi-trash"></i>
                          </button>
                        </div>
                      </div>
                    </c-card-body>
                  </c-card>
                }
              } @else {
                <div class="d-flex justify-content-center">
                  <span class="text-muted">No sub-ledgers</span>
                </div>
              }
            </div>
          </ng-template>
        </c-accordion-item>
      }
    </c-accordion>

  } @else {
    @if (!isSearchActive) {
      <app-empty-data imageSrc="assets/images/animations/units.gif"
                      [message]="'administration.accounting.ledger-group.pages.list.empty-data'|translate">
      </app-empty-data>
    } @else {
      <app-empty-data imageSrc="assets/images/animations/no-result.gif">
      </app-empty-data>
    }
  }

}
