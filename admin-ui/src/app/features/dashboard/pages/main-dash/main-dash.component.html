<app-page-title [title]="('dashboards.main.title'|translate).concat('Hamza HABCHI')"
                [subTitle]="'dashboards.main.subtitle'|translate"></app-page-title>

<c-row>
  <c-col [md]="8">

    <c-row>

      <c-col [md]="3">
        <app-card-widget></app-card-widget>
      </c-col>

      <c-col [md]="3">
        <app-card-widget></app-card-widget>
      </c-col>

      <c-col [md]="3">
        <app-card-widget></app-card-widget>
      </c-col>

      <c-col [md]="3">
        <app-card-widget></app-card-widget>
      </c-col>

    </c-row>


  </c-col>



</c-row>




<ng-container>


  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading dashboard data...</p>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="!isLoading && dashboardKPIs">
    <!-- Main Layout Row -->
    <c-row class="g-3">
      <c-col xs="12" md="7" lg="8">
        <!-- Widget Container (without revenue metrics) -->
        <div>
          <app-widget-container [widgets]="dashboardWidgets" [showRevenueMetrics]="false"></app-widget-container>
        </div>

        <!-- Income Chart Row below widgets -->
        <c-row class="g-3 mt-3">
          <c-col xs="12" md="8">
            <div class="card">
              <div class="card-body">
                <apx-chart
                  #chart
                  [series]="chartOptions.series!"
                  [chart]="chartOptions.chart!"
                  [xaxis]="chartOptions.xaxis!"
                  [dataLabels]="chartOptions.dataLabels!"
                  [grid]="chartOptions.grid!"
                  [stroke]="chartOptions.stroke!"
                  [title]="chartOptions.title!">
                </apx-chart>
              </div>
            </div>
          </c-col>
          <c-col xs="12" md="4">
            <div class="card">
              <app-pie-chart></app-pie-chart>
            </div>
          </c-col>
        </c-row>
      </c-col>

      <!-- Right Column: Revenue Metrics -->
      <c-col xs="12" md="5" lg="4" class="d-flex flex-column">
        <app-revenue-metrics [metrics]="revenueMetrics"></app-revenue-metrics>
        <!-- Room Status aligned with bottom cards -->
        <div class="mt-3 d-flex flex-column flex-grow-1">
          <div class="card h-100 d-flex flex-column">
            <div class="card-header">
              <h5 class="card-title mb-0">Occupancy</h5>
            </div>
            <div class="card-body d-flex justify-content-center align-items-center p-2 flex-grow-1">
              <div class="chart-wrapper">
                <div class="charts-container">
                  <div class="occupancy-chart">
                    <apx-chart
                      [series]="radialChartOptions.series"
                      [chart]="radialChartOptions.chart"
                      [plotOptions]="radialChartOptions.plotOptions"
                      [labels]="radialChartOptions.labels"
                      [colors]="radialChartOptions.colors">
                    </apx-chart>
                  </div>
                  <div class="room-status-chart">
                    <app-circle-chart-custom-angle></app-circle-chart-custom-angle>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </c-col>
    </c-row>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !dashboardKPIs" class="text-center py-5">
    <div class="alert alert-warning" role="alert">
      <h4 class="alert-heading">Unable to load dashboard data</h4>
      <p>There was an error loading the dashboard information. Please try refreshing the page.</p>
      <button class="btn btn-primary" (click)="loadDashboardData()">Retry</button>
    </div>
  </div>
</ng-container>
